---
title: Ohm v18 Beta
slug: ohm-v18
description: "Ohm v18 compiles grammars to WebAssembly, making parsing ~20x faster and using a fraction of the memory."
image: ./ohm-v18.png
---

_aka "The One that Compiles to Wasm"._

After nearly a year of development, we're excited to announce the first beta release of Ohm v18 â€” the biggest change to Ohm since its initial release. We've totally reworked the core parsing engine to be WebAssembly-based, making parsing around 20x faster on real-world grammars while using a fraction of the memory.

## What's new

Every version of Ohm up to v17 worked the same way under the hood: when you call `grammar.match()`, Ohm walks a tree of parsing expression objects (PExprs), calling `eval()` on each node. (It's a so-called [tree-walking interpreter](https://craftinginterpreters.com/a-tree-walk-interpreter.html).) In the process, it builds up a huge parse tree, with each node a separate object that must be managed by the GC.

v18 takes a completely different approach. At build time, the new `@ohm-js/compiler` translates your grammar into a WebAssembly module, compiling each rule to its own function. The parse tree is allocated into Wasm linear memory, and nodes used a packed representation which is much, much more memory efficient.

Also, the runtime (`ohm-js`) is now separate from the compiler (`@ohm-js/compiler`):

```bash
npx ohm2wasm my-grammar.ohm   # compile at build time
```

```js
import {Grammar} from 'ohm-js';

// load and run at runtime
const g = await Grammar.instantiate(fs.readFileSync('my-grammar.wasm'));
```

## How much faster?

We've been benchmarking with two real-world workloads:

1. Our [official ES5 grammar](https://github.com/ohmjs/ohm/blob/main/examples/ecmascript/src/es5.ohm) compiling a large (742K) JavaScript file.
2. Shopify's [LiquidHTML grammar](https://github.com/Shopify/theme-tools/blob/main/packages/liquid-html-parser/grammar/liquid-html.ohm), parsing all the Liquid templates from their [Dawn theme](https://github.com/Shopify/dawn).

One these two benchmarks, v18 parses about **22x faster** than v17, and requires less than 20% of the memory. ðŸ”¥

## Breaking changes

Along with the new runtime, v18 has a significantly reworked API. Check out the [migration guide](../docs/releases/ohm-js-18.0) for all the details on the new API, what's changed, and what's not in v18 yet.

And please note: **the new API is still in flux**, so expect some changes before the stable release.

## Try it out

```bash
npm install ohm-js@beta                      # Runtime (production dependency)
npm install --save-dev @ohm-js/compiler@beta # Compiler (dev dependency)
```

If you want to kick the tires without changing your build setup, there's a compat helper that parses, compiles, and instantiates in one step â€” just like the old `ohm.grammar()`:

```js
import {grammar} from '@ohm-js/compiler/compat';

const g = grammar('MyGrammar { start = "hello" }');
using result = g.match('hello');
```

(This compiles on every call, so it's great for prototyping but probably not what you want for production.)

We'd love to hear your feedback on v18. Give it a spin, and let us know what you think on [Discord](https://discord.gg/KwxY5gegRQ) or [GitHub Discussions](https://github.com/ohmjs/ohm/discussions).
